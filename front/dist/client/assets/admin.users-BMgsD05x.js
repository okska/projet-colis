import{i as y,r as a,j as e,k as N,p as g}from"./main-CYDXynsJ.js";const w={pending_verification:"En vérification",active:"Actif",suspended:"Suspendu",blocked:"Bloqué"};function S(){const{allowed:n,users:d,needsClientFetch:c}=y.useLoaderData(),[u,o]=a.useState(d),[v,m]=a.useState(n),[x,p]=a.useState(c),[h,f]=a.useState(null),[j,l]=a.useState(null);if(a.useEffect(()=>{o(d),m(n)},[n,d]),a.useEffect(()=>{if(!c)return;let s=!1;return(async()=>{p(!0),l(null);try{const t=await N();if(s)return;o(t),m(!0)}catch(t){if(s)return;const i=t?.status;i===401||i===403?m(!1):l(t instanceof Error?t.message:"Impossible de charger les utilisateurs.")}finally{s||p(!1)}})(),()=>{s=!0}},[c]),!v)return e.jsxs("section",{className:"space-y-4 p-4","aria-busy":x,children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Administration"}),x?e.jsx("p",{className:"text-sm text-slate-600",children:"Chargement…"}):e.jsx("p",{className:"text-sm text-slate-600",children:"Vous devez être administrateur pour accéder à cette page."})]});const b=async s=>{f(s),l(null);try{const r=await g(s);o(t=>t.map(i=>i.id===s?r:i))}catch(r){const t=r instanceof Error?r.message:"Impossible de mettre à jour ce profil.";l(t)}finally{f(null)}};return e.jsxs("section",{className:"space-y-4 p-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-slate-500",children:"Administration"}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Gestion des utilisateurs"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Consultez les comptes inscrits et activez leur rôle de livreur."})]}),j&&e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:j}),e.jsx("div",{className:"overflow-x-auto rounded-md border border-slate-200 bg-white","aria-busy":x,children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Utilisateur"}),e.jsx("th",{className:"px-4 py-2",children:"Email"}),e.jsx("th",{className:"px-4 py-2",children:"Statut livreur"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-4 text-sm text-slate-500",colSpan:4,children:"Aucun utilisateur à afficher."})}):u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-slate-900",children:s.name??"Utilisateur sans nom"}),e.jsx("td",{className:"px-4 py-3 text-slate-600",children:s.email}),e.jsx("td",{className:"px-4 py-3",children:s.driverStatus?w[s.driverStatus]:"Non livreur"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{type:"button",onClick:()=>b(s.id),disabled:s.isDriver||h===s.id,className:"rounded-md border border-slate-300 px-3 py-1 text-sm font-medium text-slate-700 transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:text-slate-400",children:s.isDriver?"Déjà livreur":h===s.id?"Activation…":"Activer comme livreur"})})]},s.id))})]})})]})}export{S as component};
